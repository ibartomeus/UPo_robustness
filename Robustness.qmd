---
title: "Robustness"
author: "I.Bartomeus"
format: pdf
editor: visual
editor_options: 
  chunk_output_type: console
---

## Fake-dynamics

Simple topological dynamics are unrealistic, but help us understand how topology affects stability in a very visual way. Here we will play with two data sets in bipartite

## Load data

```{r}
#| echo: true
#| output: false

#install.packages("bipartite")
library(bipartite)

#load data
?bipartite

olesen2002flores
olesen2002aigrettes
```

## Compare two networks

```{r}
#calculate size, conectance and nestedness
networklevel(web = olesen2002flores, index = c("number of species",
                                               "connectance",
                                               "NODF"))
networklevel(web = olesen2002aigrettes, index = c("number of species",
                                               "connectance",
                                               "NODF"))
```

It looks like Aigrettes has higher C, N and M, indicating higher robustness. Let's check it.

```{r}
#select how we lose species for flores. 
r1f <- second.extinct(web = olesen2002flores, 
                      method = "random") #random
r2f <- second.extinct(web = olesen2002flores, 
                      method = "abundance") #less to more abundant
r3f <- second.extinct(web = olesen2002flores,
                      method = "degree") #more to less degree

#Plot it (a bit convoluted, because we need the cumulative sum)
plot(cumsum(r1f[,"ext.higher"]), cumsum(r1f[,"ext.lower"]), 
     las = 1, t = "l", 
     xlab = "Extinctions", ylab = "Secondary extinctions")
lines(cumsum(r2f[,"ext.higher"]), cumsum(r2f[,"ext.lower"]), 
      las = 1, t = "l", col = 2)
lines(cumsum(r3f[,"ext.higher"]), cumsum(r3f[,"ext.lower"]), 
      las = 1, t = "l", col = 3)

robustness(r1f)
robustness(r2f)
robustness(r3f)

#Same for Aigrettes 
r1a <- second.extinct(web = olesen2002aigrettes, 
                      method = "random") #random
r2a <- second.extinct(web = olesen2002aigrettes, 
                      method = "abundance") #less to more abundant
r3a <- second.extinct(web = olesen2002aigrettes, 
                      method = "degree") #more to less connected

plot(cumsum(r1a[,"ext.higher"]), cumsum(r1a[,"ext.lower"]), 
     las = 1, t = "l", 
     xlab = "Extinctions", ylab = "Secondary extinctions")
lines(cumsum(r2a[,"ext.higher"]), cumsum(r2a[,"ext.lower"]), 
      las = 1, t = "l", col = 2)
lines(cumsum(r3a[,"ext.higher"]), cumsum(r3a[,"ext.lower"]), 
      las = 1, t = "l", col = 3)

robustness(r1a)
robustness(r2a)
robustness(r3a)

#comparamos both
#random
plot(cumsum(r1f[,"ext.higher"]), cumsum(r1f[,"ext.lower"]), 
     las = 1, t = "l", 
     xlab = "Extinctions", ylab = "Secondary extinctions")
lines(cumsum(r1a[,"ext.higher"]), cumsum(r1a[,"ext.lower"]), 
      las = 1, t = "l", col = 4)

#abundance
plot(cumsum(r2f[,"ext.higher"]), cumsum(r2f[,"ext.lower"]), 
     las = 1, t = "l", 
     xlab = "Extinctions", ylab = "Secondary extinctions")
lines(cumsum(r2a[,"ext.higher"]), cumsum(r2a[,"ext.lower"]), 
      las = 1, t = "l", col = 4)
```

Yes, it looks like Aigrettes is more robust to species loss. But note this models are extremely simplified, and in nature species do not get extinct one by one, they can rewire their interactions and many more mecanisms operate at once (e.g. immigration).
